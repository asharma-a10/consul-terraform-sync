# This file is generated by Consul Terraform Sync.
#
# The HCL blocks, arguments, variables, and values are derived from the
# operator configuration for Sync. Any manual changes to this file
# may not be preserved and could be overwritten by a subsequent update.
#
# Task: slb-automation-4
# Description: automate slb servers for vThunder

services = {
{{- with $srv := service "api" }}
  {{- $last := len $srv | subtract 1}}
  {{- range $i, $s := $srv}}
  "{{ joinStrings "." .ID .Node .Namespace .NodeDatacenter }}" : {
{{ HCLService $s | indent 4 }}
  } {{- if (ne $i $last)}},{{end}}
  {{- end}}
{{- end}}{{- with $beforeSrv := service "api" }}
  {{- with $afterSrv := service "db" }},{{end}}
{{- end}}
{{- with $srv := service "db" }}
  {{- $last := len $srv | subtract 1}}
  {{- range $i, $s := $srv}}
  "{{ joinStrings "." .ID .Node .Namespace .NodeDatacenter }}" : {
{{ HCLService $s | indent 4 }}
  } {{- if (ne $i $last)}},{{end}}
  {{- end}}
{{- end}}{{- with $beforeSrv := service "db" }}
  {{- with $afterSrv := service "web" }},{{end}}
{{- end}}
{{- with $srv := service "web" }}
  {{- $last := len $srv | subtract 1}}
  {{- range $i, $s := $srv}}
  "{{ joinStrings "." .ID .Node .Namespace .NodeDatacenter }}" : {
{{ HCLService $s | indent 4 }}
  } {{- if (ne $i $last)}},{{end}}
  {{- end}}
{{- end}}
}
